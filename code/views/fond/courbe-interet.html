<script src="../../static/js/plotly-latest.min.js"></script>
<h1>Tableau de Bord Analytique</h1>
<p>Statistiques et indicateurs clés de performance</p>
    <input type="date" name="" id="date_deb">
    <input type="date" name="" id="date_fin">
    <button type="submit" onclick="getInteret()">Afficher</button>

    <script>
        if (typeof apiBase === 'undefined') {
            var apiBase = "http://localhost/S4/s4_final_exam/code/ws";
        }
        console.log("JavaScript chargé");
  
        function ajax(method, url, data, callback) {
          const xhr = new XMLHttpRequest();
          xhr.open(method, apiBase + url, true);
          xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
          xhr.onreadystatechange = () => {
            if (xhr.readyState === 4 && xhr.status === 200) {
              callback(JSON.parse(xhr.responseText));
            }
          };
          xhr.send(data);
        }

        function getInteret() {
    const date_deb = document.getElementById("date_deb").value;
    const date_fin = document.getElementById("date_fin").value;

    if (!date_deb || !date_fin) {
        alert("Veuillez remplir tous les champs");
        return;
    }

    const data = `date_deb=${encodeURIComponent(date_deb)}&date_fin=${encodeURIComponent(date_fin)}`;

    ajax("POST", "/courbe", data, (response) => {
        const mois = response[0];
        const interets = response[1];

        // Affichage du graphique avec Plotly
        Plotly.newPlot("graph", [{
            x: mois,
            y: interets,
            type: "scatter",
            mode: "lines+markers",
            name: "Intérêts",
            line: {
                color: "#52b788",
                width: 3,
                shape: "spline"
            },
            marker: {
                size: 8,
                color: "#52b788"
            }
        }], {
            xaxis: { title: "Mois" },
            yaxis: { title: "Intérêts (Ar)" },
            legend: { orientation: "h", y: -0.2 },
            margin: { t: 30, b: 80, l: 50, r: 30 },
            plot_bgcolor: "#ffffff",
            paper_bgcolor: "#ffffff",
            font: { color: "#2c3e50" }
        });
    });
}


        
    </script>